<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Jerwell Escusa - Database Design</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../icon.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../cs50_sql/design.html">CS50 SQL: Human Resources Database</a></li><li class="breadcrumb-item"><a href="../cs50_sql/design.html">Database Design</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Jerwell Escusa</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Jerwell Escusa</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">CS50 SQL: Human Resources Database</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cs50_sql/design.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Database Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cs50_sql/schema.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Database Schema</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../cs50_sql/queries.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Database Queries</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">University of Helsinki: Data Analysis with Python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../helsinki_dap2324/project_regression-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression Analysis Project</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#scope1" id="toc-scope1" class="nav-link active" data-scroll-target="#scope1">Scope</a></li>
  <li><a href="#functional-requirements" id="toc-functional-requirements" class="nav-link" data-scroll-target="#functional-requirements">Functional Requirements</a></li>
  <li><a href="#representation" id="toc-representation" class="nav-link" data-scroll-target="#representation">Representation</a>
  <ul>
  <li><a href="#entities" id="toc-entities" class="nav-link" data-scroll-target="#entities">Entities</a>
  <ul class="collapse">
  <li><a href="#employees" id="toc-employees" class="nav-link" data-scroll-target="#employees">Employees</a></li>
  <li><a href="#jobs" id="toc-jobs" class="nav-link" data-scroll-target="#jobs">Jobs</a></li>
  <li><a href="#managers" id="toc-managers" class="nav-link" data-scroll-target="#managers">Managers</a></li>
  <li><a href="#departments" id="toc-departments" class="nav-link" data-scroll-target="#departments">Departments</a></li>
  <li><a href="#job-histories" id="toc-job-histories" class="nav-link" data-scroll-target="#job-histories">Job Histories</a></li>
  <li><a href="#attendance-logs" id="toc-attendance-logs" class="nav-link" data-scroll-target="#attendance-logs">Attendance Logs</a></li>
  <li><a href="#savings" id="toc-savings" class="nav-link" data-scroll-target="#savings">Savings</a></li>
  <li><a href="#payrolls" id="toc-payrolls" class="nav-link" data-scroll-target="#payrolls">Payrolls</a></li>
  <li><a href="#satisfaction-scores" id="toc-satisfaction-scores" class="nav-link" data-scroll-target="#satisfaction-scores">Satisfaction Scores</a></li>
  <li><a href="#performance-scores" id="toc-performance-scores" class="nav-link" data-scroll-target="#performance-scores">Performance Scores</a></li>
  <li><a href="#attritions" id="toc-attritions" class="nav-link" data-scroll-target="#attritions">Attritions</a></li>
  </ul></li>
  <li><a href="#relationships" id="toc-relationships" class="nav-link" data-scroll-target="#relationships">Relationships</a></li>
  </ul></li>
  <li><a href="#optimizations" id="toc-optimizations" class="nav-link" data-scroll-target="#optimizations">Optimizations</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../cs50_sql/design.html">CS50 SQL: Human Resources Database</a></li><li class="breadcrumb-item"><a href="../cs50_sql/design.html">Database Design</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Database Design</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="scope1" class="level2">
<h2 class="anchored" data-anchor-id="scope1">Scope<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></h2>
<p>The Human Resources (HR) database facilitates the performance of HR department responsibilities such as recording employee attendance, calculating payroll, and conducting employee analytics.</p>
<p>The following entities are included in this database scope to enable the above features:</p>
<ul>
<li>Departments, containing information on the department name and its head</li>
<li>Managers, containing information about the managers</li>
<li>Employees, containing identifying information of the employees</li>
<li>Jobs, containing a list of available job titles and their pay rate</li>
<li>Job Histories, containing job and salary history of employees</li>
<li>Attendance Logs, containing detailed information on daily employee attendance</li>
<li>Savings, containing savings plan history of employees</li>
<li>Payrolls, containing information on monthly employee payroll</li>
<li>Satisfaction scores, containing results of employee satisfaction survey</li>
<li>Performance Scores, containing reports of employee performance evaluation</li>
<li>Attritions, containing details about employee attrition</li>
</ul>
<p>The scope of the HR database excludes other HR-related responsibilities such as handling income tax and other deductions, health information, and incident reports. The information of employees recorded is only up to department heads. The database is for internal use only.</p>
</section>
<section id="functional-requirements" class="level2">
<h2 class="anchored" data-anchor-id="functional-requirements">Functional Requirements</h2>
<p>This database will support:</p>
<ul>
<li>CRUD operations for HR staff</li>
<li>Employee-initiated create and update operations for attendance logging</li>
<li>Representation of the company’s internal structure</li>
<li>Tracking of daily employee attendance</li>
<li>Tracking of job and salary history</li>
<li>Automatic adjustment of employee savings plan</li>
<li>Calculation of monthly employee payroll</li>
<li>Data collection for employee analytics</li>
</ul>
<p>This database security and access control is limited by the capabilities of SQLite. As such, only the HR staff can currently directly interface with the database. Also, the attendance logging feature requires a software extension to interface with the employees’ time ins and time outs. As stated in the previous section, the scope of the database is insufficient for the usual requirements of the end users.</p>
</section>
<section id="representation" class="level2">
<h2 class="anchored" data-anchor-id="representation">Representation</h2>
<p>Entities are represented with SQLite tables using the following schema.</p>
<section id="entities" class="level3">
<h3 class="anchored" data-anchor-id="entities">Entities</h3>
<p>The database includes the following entities:</p>
<section id="employees" class="level4">
<h4 class="anchored" data-anchor-id="employees">Employees</h4>
<p>The <code>employees</code> table includes:</p>
<ul>
<li><code>id</code>, which contains the unique ID for the employee as an <code>INTEGER</code>. Thus, this column is assigned the <code>PRIMARY KEY</code> constraint.</li>
<li><code>first_name</code>, which contains the employee’s first name as <code>TEXT</code>. Names can be represented appropriately by a <code>TEXT</code> type. A <code>NOT NULL</code> constraint is applied to ensure the employee is identifiable.</li>
<li><code>last_name</code>, which contains the employee’s last name as <code>TEXT</code> and has the <code>NOT NULL</code> constraint applied. The rationale is the same as with <code>first_name</code>.</li>
<li><code>SSS</code>, which contains the Social Security number of the employee as <code>TEXT</code>. A <code>TEXT</code> type is chosen so a length check (10 digits) can be performed. Mathematical operations are not necessary with this column, so the values need not be treated as numbers. A <code>NOT NULL</code> constraint is applied, since this is necessary information for payroll.</li>
<li><code>birth_date</code>, which contains the date of birth of the employee as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for date values with the format ‘YYYY-MM-DD’. A <code>NOT NULL</code> constraint is applied as proof of birth is required for employment.</li>
<li><code>sex_at_birth</code>, which contains the sex assigned at the birth of the employee. Sex assigned at birth can be appropriately represented by the <code>TEXT</code> type. Currently, the local law only recognizes either ‘female’ or ‘male’ sex, so values are restricted to these two. A <code>NOT NULL</code> constraint is applied since proof of birth includes this information.</li>
<li><code>email</code>, which contains the email address details of an employee as <code>TEXT</code>. A <code>TEXT</code> type is chosen because an email address can be represented by a text string. A <code>NOT NULL</code> constraint is applied since employees should be able to be contacted by other employees and the management. The <code>UNIQUE</code> constraint is applied, so contact details are unique to an employee.</li>
<li><code>contact_number</code>, which contains the SIM card number of an employee as <code>TEXT</code>. The reason for the <code>TEXT</code> type is the same as for <code>SSS</code> but with the required length of 11 digits. The rationale for the <code>NOT NULL</code> and <code>UNIQUE</code> constraints is the same with <code>email</code>.</li>
<li><code>civil_status</code>, which contains the civil status of the employee as <code>TEXT</code>. Civil status is appropriately represented by the <code>TEXT</code> type. The valid values are restricted to: ‘single’, ‘married’, ‘widowed’, and ‘legally separated’.</li>
<li><code>start_date</code>, which contains the date the employee started working for the company as <code>NUMERIC</code>. The <code>NUMERIC</code> type is applied for the same reason as the <code>birth_date</code>. A <code>NOT NULL</code> constraint is applied as you cannot be an employee without the date you started working.</li>
<li><code>end_date</code>, which, if applicable, contains the date when the employee stopped working for the company as <code>NUMERIC</code>. The <code>NUMERIC</code> type is applied for the same reason as the other date values.</li>
<li><code>job_id</code>, which contains the ID of the job of an employee as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>jobs</code> table.</li>
<li><code>manager_id</code>, which contains the ID of the manager supervising the employee as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>managers</code> table.</li>
<li><code>department_name</code>, which contains the name uniquely identifying the department where the employee belongs as <code>TEXT</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>name</code> column in the <code>departments</code> table. In case the department name is updated (e.g., after department merging), the <code>ON UPDATE CASCADE</code> clause is added.</li>
</ul>
</section>
<section id="jobs" class="level4">
<h4 class="anchored" data-anchor-id="jobs">Jobs</h4>
<p>The <code>jobs</code> table includes:</p>
<ul>
<li><code>id</code>, which contains the unique ID of the job as an <code>INTEGER</code>. Thus, this column is assigned the <code>PRIMARY KEY</code> constraint.</li>
<li><code>name</code>, which contains the name of the job title as <code>TEXT</code>. Names consist of text strings, so the <code>TEXT</code> type is appropriate. A <code>NOT NULL</code> constraint is applied since a job needs a name.</li>
<li><code>minimum_rate</code>, which contains the minimum hourly pay rate for the job as <code>NUMERIC</code>. A <code>NUMERIC</code> type is assigned to be able to represent the pay rate with and without floating point. A <code>NOT NULL</code> constraint is applied as the range of values for pay rate also identifies the job.</li>
<li><code>maximum_rate</code>, which contains the maximum hourly pay rate for the job as <code>NUMERIC</code> with a <code>NOT NULL</code> constraint. The rationale for the data type and constraint is the same as`minimum_rate.</li>
</ul>
</section>
<section id="managers" class="level4">
<h4 class="anchored" data-anchor-id="managers">Managers</h4>
<p>The <code>managers</code> table includes:</p>
<ul>
<li><code>id</code>, which contains the unique ID of the manager as an <code>INTEGER</code>. Thus, this column is assigned the <code>PRIMARY KEY</code> constraint.</li>
<li><code>employee_id</code>, which contains the ID of the employee assigned as a manager as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>employees</code> table. An <code>ON DELETE SET NULL</code> clause is added, so the manager position is left vacant, not deleted, in the event the employee-manager leaves the company.</li>
<li><code>start_date</code>, which contains the date the employee started working as a manager as <code>NUMERIC</code>. The <code>NUMERIC</code> type is appropriate for representing dates. A <code>NOT NULL</code> constraint is applied as employees cannot be a manager without the date they started the role.</li>
<li><code>end_date</code>, which contains the date the employee stopped working as a manager as <code>NUMERIC</code>. The rationale for this type is the same as <code>start_date</code>.</li>
</ul>
</section>
<section id="departments" class="level4">
<h4 class="anchored" data-anchor-id="departments">Departments</h4>
<p>The <code>departments</code> table includes:</p>
<ul>
<li><code>name</code>, which contains the name uniquely identifying the department as <code>TEXT</code>. Thus, this column is assigned the <code>PRIMARY KEY</code> constraint. The number of departments is relatively few, so a name is more convenient to use instead of a number as the unique ID.</li>
<li><code>head_id</code>, which contains the ID of the employee assigned as the department head as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>employees</code> table. An <code>ON DELETE SET NULL</code> clause is added, so the department head is left vacant, not deleted, in the event the department head employee leaves the company.</li>
<li><code>start_date</code>, which contains the date the employee started working as a department head as <code>NUMERIC</code>. The <code>NUMERIC</code> type is appropriate for representing dates. A <code>NOT NULL</code> constraint is applied as an employee cannot be a department head without a date they started the role.</li>
<li><code>end_date</code>, which contains the date the employee stopped working as a department head as <code>NUMERIC</code>. The rationale for this type is the same as <code>start_date</code>.</li>
</ul>
</section>
<section id="job-histories" class="level4">
<h4 class="anchored" data-anchor-id="job-histories">Job Histories</h4>
<p>The <code>job_histories</code> table includes:</p>
<ul>
<li><code>employee_id</code>, which contains the ID of the employee with a job title and/or pay change as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>employee</code> table. An <code>ON DELETE CASCADE</code> clause is added, so the job histories of an employee will also be deleted when the employee is deleted from the <code>employees</code> table. Disposal is conducted after the legally mandated employee retention time is up.</li>
<li><code>job_id</code>, which contains the ID of the employee’s job as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>jobs</code> table.</li>
<li><code>start_date</code>, which contains the date when the employee starts with the new job title and/or pay as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for storing date values. The <code>employee_id</code> and <code>start_date</code> combined can uniquely identify the job histories and thus are assigned the <code>PRIMARY KEY</code> constraint.</li>
<li><code>hourly_rate</code>, which contains the new hourly pay rate of the employee as <code>NUMERIC</code>. A <code>NUMERIC</code> type can both represent the pay rate with and without a floating point. A <code>NOT NULL</code> constraint is applied because a job requires a pay rate. The pay rate is also checked if it satisfies the minimum pay rate of 75.</li>
<li><code>raise/cut</code>, which contains, if applicable, the calculated pay raise/cut from the previous recorded job history as <code>NUMERIC</code> The rationale for the <code>NUMERIC</code> type is the same as in <code>hourly_rate</code>.</li>
</ul>
</section>
<section id="attendance-logs" class="level4">
<h4 class="anchored" data-anchor-id="attendance-logs">Attendance Logs</h4>
<p>The <code>attendance_logs</code> table includes:</p>
<ul>
<li><code>employee_id</code>, which contains the ID of the employee whose attendance is being recorded as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>employee</code> table. An <code>ON DELETE CASCADE</code> clause is added, so the attendance logs of an employee will also be deleted when the employee is deleted from the <code>employees</code> table. Disposal is conducted after the legally mandated employee retention time is up.</li>
<li><code>date</code>, which contains the date when the attendance is being recorded as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for storing date values. The <code>employee_id</code> and <code>date</code> combined can uniquely identify the record for attendance and thus are assigned the <code>PRIMARY KEY</code> constraint.</li>
<li><code>time_in</code>, which contains the time the employee clocked in for the day as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for storing date and time values.</li>
<li><code>time_out</code>, which contains the time the employee clocked out for the day as <code>NUMERIC</code>. The rationale for the <code>NUMERIC</code> type is the same as <code>time_out</code>.</li>
<li><code>hours_worked</code>, which contains the calculated hours worked by the employee as <code>INTEGER</code>. An <code>INTEGER</code> type is assigned as this adequately represents the required specificity for the values. The value is also checked if it is under the mandated maximum of 12 hours worked.</li>
<li><code>overtime_hours</code>, which contains the calculated hours worked for overtime by the employee as <code>INTEGER</code>. The rationale for the <code>INTEGER</code> type is the same as <code>hours_worked</code>.</li>
<li><code>tardy</code>, which contains the classification of whether the employee timed in late or not as an <code>INTEGER</code>. An <code>INTEGER</code> type is assigned to represent either 0 as not late or 1 as late. Only these two values are considered valid values.</li>
<li><code>type</code>, which contains the classification of the shift type of the employee based on the hours worked as a <code>TEXT</code>. A <code>TEXT</code> type is assigned to represent the following valid values: ‘undertime’, ‘normal’, ‘overtime’, and ’paid leave`</li>
</ul>
</section>
<section id="savings" class="level4">
<h4 class="anchored" data-anchor-id="savings">Savings</h4>
<p>The <code>savings</code> table includes:</p>
<ul>
<li><code>date</code>, which contains the date the employee Social Security System (SSS) savings plan is being recorded as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for storing date values. The <code>date</code> and <code>employee_id</code> combined can uniquely identify the record of a savings plan and thus are assigned the <code>PRIMARY KEY</code> constraint.</li>
<li><code>employee_id</code>, which contains the ID of the employee whose savings plan is being recorded as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>employee</code> table. An <code>ON DELETE CASCADE</code> clause is added, so the recorded savings plan of an employee will also be deleted when the employee is deleted from the <code>employees</code> table. Disposal is conducted after the legally mandated employee retention time is up.</li>
<li><code>salary_change</code>, which contains the calculated salary change of an employee based on the latest job history record as <code>NUMERIC</code>. A <code>NUMERIC</code> type can represent the salary change with and without a floating point.</li>
<li><code>previous_rate</code>, which contains, if applicable, the previous savings rate of the employee as <code>NUMERIC</code>. A <code>NUMERIC</code> type is adequate for representing numbers with decimal points.</li>
<li><code>adjusted_rate</code>, which contains the calculated employee savings rate adjusted based on the <code>salary_change</code> as <code>NUMERIC</code>. The rationale for the <code>NUMERIC</code> type is the same as <code>previous_rate</code>.</li>
</ul>
</section>
<section id="payrolls" class="level4">
<h4 class="anchored" data-anchor-id="payrolls">Payrolls</h4>
<p>The <code>payrolls</code> table includes:</p>
<ul>
<li><code>date</code>, which contains the date an employee’s monthly payroll is being recorded as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for storing date values. The <code>date</code> and <code>employee_id</code> combined can uniquely identify the record of a payroll and thus are assigned the <code>PRIMARY KEY</code> constraint.</li>
<li><code>employee_id</code>, which contains the ID of the employee whose payroll is being recorded as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>employee</code> table. An <code>ON DELETE CASCADE</code> clause is added, so the recorded payroll of an employee will also be deleted when the employee is deleted from the <code>employees</code> table. Disposal is conducted after the legally mandated employee retention time is up.</li>
<li><code>hourly_rate</code>, which contains the hourly pay rate of the employee based on the latest job history record as <code>NUMERIC</code>. A <code>NUMERIC</code> type can represent the pay rate with and without a floating point. A <code>NOT NULL</code> constraint is applied because payroll cannot be calculated without a pay rate.</li>
<li><code>regular_hours</code>, which contains the calculated hours worked of the employee based on attendance logs as <code>INTEGER</code>. An <code>INTEGER</code> type is assigned as this adequately represents the required specificity for the values. A <code>NOT NULL</code> constraint is applied because payroll cannot be calculated without hours worked.</li>
<li><code>overtime_hours</code>, which contains the calculated hours worked of the employee for overtime based on attendance logs as <code>INTEGER</code>. The rationale for the <code>INTEGER</code> type is the same as <code>regular_hours</code>.</li>
<li><code>paid_leave</code>, which contains a count of the paid leaves used by the employee based on attendance logs as <code>INTEGER</code>. The <code>INTEGER</code> adequately represents a count of values.</li>
<li><code>gross_pay</code>, which contains the calculated gross pay of an employee as <code>NUMERIC</code>. A <code>NUMERIC</code> type can represent the gross pay with decimal values.</li>
<li><code>SSS_deduction</code>, which contains the calculated SSS deduction to the gross pay of an employee (based on their latest savings rate) as <code>NUMERIC</code>. A <code>NUMERIC</code> type can represent the SSS deduction with decimal values.</li>
<li><code>taxable_pay</code>, which contains the calculated taxable pay of an employee after the SSS deduction as <code>NUMERIC</code>. A <code>NUMERIC</code> type can represent the taxable pay with decimal values.</li>
</ul>
</section>
<section id="satisfaction-scores" class="level4">
<h4 class="anchored" data-anchor-id="satisfaction-scores">Satisfaction Scores</h4>
<p>The <code>satisfaction_scores</code> table includes:</p>
<ul>
<li><code>date</code>, which contains the date the employee’s satisfaction scores are being recorded as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for storing date values. The <code>date</code> and <code>employee_id</code> combined can uniquely identify the record of satisfaction scores and thus are assigned the <code>PRIMARY KEY</code> constraint.</li>
<li><code>employee_id</code>, which contains the ID of the employee whose satisfaction scores are being recorded as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>employee</code> table. An <code>ON DELETE CASCADE</code> clause is added, so the recorded satisfaction scores of an employee will also be deleted when the employee is deleted from the <code>employees</code> table. Disposal is conducted after the legally mandated employee retention time is up.</li>
<li><code>compensation_score</code>, which contains the response to a Likert scale survey of the employee rating compensation as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), so an <code>INTEGER</code> type is appropriate.</li>
<li><code>workload_score</code>, which contains the response to a Likert scale survey of the employee rating workload as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), so an <code>INTEGER</code> type is appropriate.</li>
<li><code>opportunity_score</code>, which contains the response to a Likert scale survey of the employee rating available opportunity as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), so an <code>INTEGER</code> type is appropriate.</li>
<li><code>environment_score</code>, which contains the response to a Likert scale survey of the employee rating the working environment as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), so an <code>INTEGER</code> type is appropriate.</li>
<li><code>leadership_score</code>, which contains the response to a Likert scale survey of the employee rating company leadership as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), so an <code>INTEGER</code> type is appropriate.</li>
<li><code>teamwork_score</code>, which contains the response to a Likert scale survey of the employee rating teamwork as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), so an <code>INTEGER</code> type is appropriate.</li>
<li><code>average_score</code>, which contains the calculated average from the Likert scale survey of employee satisfaction as <code>NUMERIC</code>. The <code>NUMERIC</code> type can represent the average satisfaction score with and without a floating point.</li>
</ul>
</section>
<section id="performance-scores" class="level4">
<h4 class="anchored" data-anchor-id="performance-scores">Performance Scores</h4>
<p>The <code>performance_scores</code> table includes:</p>
<ul>
<li><code>date</code>, which contains the date the employee’s performance scores, as evaluated by their immediate superior, are being recorded as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for storing date values. The <code>date</code> and <code>employee_id</code> combined can uniquely identify the record of performance scores and thus are assigned the <code>PRIMARY KEY</code> constraint.</li>
<li><code>employee_id</code>, which contains the ID of the employee whose performance scores are being recorded as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>employee</code> table. An <code>ON DELETE CASCADE</code> clause is added, so the recorded performance scores of an employee will also be deleted when the employee is deleted from the <code>employees</code> table. Disposal is conducted after the legally mandated employee retention time is up.</li>
<li><code>productivity_score</code>, which contains the response to a Likert scale survey of the immediate superior evaluating an employee’s productivity as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), so an <code>INTEGER</code> type is appropriate.</li>
<li><code>quality_score</code>, which contains the response to a Likert scale survey of the immediate superior evaluating an employee’s work quality as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), and so an <code>INTEGER</code> type is appropriate.</li>
<li><code>teamwork_score</code>, which contains the response to a Likert scale survey of the immediate superior evaluating an employee’s teamwork skills as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), so an <code>INTEGER</code> type is appropriate.</li>
<li><code>initiative_score</code>, which contains the response to a Likert scale survey of the immediate superior evaluating an employee’s initiative as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), so an <code>INTEGER</code> type is appropriate.</li>
<li><code>leadership_score</code>, which contains the response to a Likert scale survey of the immediate superior evaluating an employee’s leadership skills as <code>INTEGER</code>. The valid response to the survey ranges from 1 to 5 (very dissatisfied to very satisfied), so an <code>INTEGER</code> type is appropriate.</li>
<li><code>average_score</code>, which contains the calculated average from the Likert scale survey of the employee performance as <code>NUMERIC</code>. The <code>NUMERIC</code> type can represent the average performance score with and without a floating point.</li>
</ul>
</section>
<section id="attritions" class="level4">
<h4 class="anchored" data-anchor-id="attritions">Attritions</h4>
<p>The <code>attritions</code> table includes:</p>
<ul>
<li><code>employee_id</code>, which contains the ID of the employee whose attrition is being recorded as an <code>INTEGER</code>. Thus, this column is assigned the <code>FOREIGN KEY</code> constraint, referencing the <code>id</code> column in the <code>employee</code> table. An <code>ON DELETE CASCADE</code> clause is added, so the attrition record of an employee will also be deleted when the employee is deleted from the <code>employees</code> table. Disposal is conducted after the legally mandated employee retention time is up.</li>
<li><code>start_date</code>, which contains the starting date of an employee in the company as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for storing date values. A <code>NOT NULL</code> constraint is applied as an employee cannot experience attrition without starting as an employee.</li>
<li><code>end_date</code>, which contains the ending date of an employee in the company as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for storing date values. The <code>employee_id</code> and <code>end_date</code> combined can uniquely identify the record for attrition and thus are assigned the <code>PRIMARY KEY</code> constraint.</li>
<li><code>deletion_date</code>, which contains the date until when the employee data is legally mandated to be retained as <code>NUMERIC</code>. A <code>NUMERIC</code> type is appropriate for storing date values. The required retention is 3 years after the employee’s <code>end_date</code>.</li>
<li><code>type</code>, which contains the type of employee attrition as <code>TEXT</code>. The valid value can only be between “voluntary” and “involuntary”, which can be represented by a<code>TEXT</code> data type.</li>
<li><code>reasons</code>, which contains the detailed reason for employee attrition as <code>TEXT</code>. A <code>TEXT</code> type is appropriate for storing detailed textual descriptions.</li>
</ul>
</section>
</section>
<section id="relationships" class="level3">
<h3 class="anchored" data-anchor-id="relationships">Relationships</h3>
<p>The below entity relationship diagram describes the relationships among the entities in the database. The employees table are referenced by all the other tables.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/er_diagram.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="ER Diagram"></p>
</figure>
</div>
<p>As detailed by the diagram:</p>
<ul>
<li>The <code>employees</code> table is referenced by all the other tables. This database is fundamentally a database about employees.</li>
<li>Each department is headed by one employee, and each department contains one or many employees.</li>
<li>One or many employees are supervised by one manager, who is themselves an employee.</li>
<li>An employee has to have a job [title] but only one. On the other hand, a job [title] can be possessed by 0 (e.g., recent job vacancy) to many employees.</li>
<li>As employees possess a job [title], they also have job histories. As employees, throughout their tenure, experience job title changes and pay changes, employees can have one or many job history entries. On the other hand, each job history entry can be related only to one employee since employees have separate job paths.</li>
<li>Employees, when they time in or time out for the day at work, trigger the recording of their attendance logs. Employees generate one to many attendance logs throughout their tenure at the company. On the other hand, each attendance log can be related only to one employee.</li>
<li>Employers are mandated by local law to contribute to each employee’s social insurance program savings plan. Thus, each employee has to have one savings [plan]. For this company, the changes in job history are tied to the savings plan, so employees are expected to have one or many savings [plan] changes. On the other hand, each savings [plan] entry is specific only to one employee.</li>
<li>Employees are entitled to 0 or many payrolls throughout their tenure at the company. Before they finish their first month, employees cannot yet receive payroll. On the other hand, each payroll entry is specific only to one employee.</li>
<li>Employees report 0 to many satisfaction scores throughout their tenure at the company. Before they finish their first month, employees cannot be expected to provide feedback to the company. On the other hand, each satisfaction score entry is specific only to one employee.</li>
<li>Employees receive performance scores throughout their tenure at the company. Before they finish their first month, employees cannot be adequately evaluated for their work. On the other hand, each satisfaction score entry is specific only to one employee.</li>
<li>Employees may suffer employee attrition. An employee either has (1) or has not (0) experienced attrition. On the other hand, each employee attrition entry is specific only to one employee.</li>
</ul>
</section>
</section>
<section id="optimizations" class="level2">
<h2 class="anchored" data-anchor-id="optimizations">Optimizations</h2>
<p>As shown in <code>queries.sql</code>, the most frequent operations for the database involve <code>INSERT</code> and <code>UPDATE</code> queries, which can be slowed down by having indexes. Furthermore, the queries are overall relatively infrequent, and the memory savings are more important than the minor time savings. For this reason, indexes are only created for the <code>first_name</code> and <code>last_name</code> columns to quickly identify the employee name from their <code>id</code>. In this database, more attention is given to creating triggers and views to save time from writing complex queries over and over.</p>
<p>The following are the triggers created:</p>
<ul>
<li>The <code>tardiness</code> trigger determines whether the employee timed in at least 30 minutes late, and it updates the <code>tardy</code> column in the <code>attendance_logs</code> table to reflect this.</li>
<li>The <code>shift_end</code> trigger determines, upon time out, the number of hours the employee worked, whether the shift falls under the type undertime, normal, or overtime, and the number of hours spent in overtime. This updates the <code>hours_worked</code>, <code>type</code>, and <code>overtime_hours</code> columns in the <code>attendance_logs</code> table.</li>
<li>The <code>new_job</code> trigger updates the <code>job_id</code> in the <code>employees</code> table to reflect the changes in the <code>job_histories</code> table. This also works with the <code>savings_adjustment</code> trigger by querying and inserting the information for the <code>date</code>, <code>employee_id</code>, <code>salary_change</code>, and <code>previous_rate</code> columns in the <code>savings</code> table.</li>
<li>The <code>savings_adjustment</code> trigger will update the <code>adjusted_rate</code> in the <code>savings</code> table based on the <code>salary_change</code> and <code>previous_rate</code> of savings. This method of automatically updating the savings rate when the employee’s salary changes is based on the work of Richard Thaler and Shlomo Benartzi, the <a href="https://www.jstor.org/stable/10.1086/380085">Save More Tomorrow™</a> program. This encourages an increase in employee savings.</li>
<li>The <code>payroll_calculation</code> trigger will calculate and update the <code>gross_pay</code>, the <code>SSS_deduction</code> (savings), and the <code>taxable_pay</code> columns in the <code>payrolls</code> table based on an <code>INSERT</code> query. The <code>INSERT</code> query collects the requisite information including the hourly pay rate, the regular and overtime hours worked, and the count of paid leaves.</li>
<li>The <code>performance_average</code> trigger will calculate and update the <code>average_score</code> column in the <code>performance_scores</code> table based on the <code>INSERT</code> query containing the performance score metrics.</li>
<li>The <code>satisfaction_average</code> trigger will calculate and update the <code>average_score</code> column in the <code>satisfaction_scores</code> table based on the <code>INSERT</code> query containing the satisfaction score metrics.</li>
<li>The <code>soft_delete_employees</code> trigger will update the <code>end_date</code> column for employees with an <code>id</code> added in the <code>attritions</code> table.</li>
</ul>
<p>The following are the views created:</p>
<ul>
<li>The <code>monthly_attendance</code> view creates a monthly overview of each employee’s attendance logs. This includes a count of types of shifts (undertime, normal, overtime), absences, paid leaves, and tardiness.</li>
<li>The <code>manager_1</code> view creates a sample view for managers showing the satisfaction scores of the employees they supervise. The <code>employee_id</code> is hidden to promote honest feedback and to prevent retaliation. The view is for the current year average only.</li>
<li>The <code>employee_evaluation</code> view creates an overview of the average performance evaluation scores of employees. This allows upper management to see employees who may need training or employees who may be considered for a raise. This report is for the current year’s average only.</li>
<li>The <code>attrition_analysis</code> view prepares the relevant employee data for an attrition analysis such as attrition status and months of tenure. This makes it easy to export the data as a CSV file for statistical analysis.</li>
</ul>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<p>The current schema assumes you have separate software and hardware that interface with the employee’s time-in and time-out actions. Also, the employee data represented is not comprehensive. It does not include other necessary information for the functioning of the human relations department like health information and incident reports. It is also unable to represent the data of upper management employees, whose positions are above the department heads. The database is limited for HR staff use due to the limitations in the possible security and access control with SQLite. Other end users need to request the information through the HR staff.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Watch a video overview here: <a href="https://youtu.be/MjUMs09HnMg" class="uri">https://youtu.be/MjUMs09HnMg</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>